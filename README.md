# 🤖 AI-fundin - 智能股票分析系统

基于AI的股票市场数据分析平台，提供实时行情、K线图表、AI智能分析等功能。

## 🌟 项目特色

- **多市场支持**: A股、美股、港股全覆盖
- **真实数据**: 对接Yahoo Finance等权威数据源，确保数据真实性
- **AI智能分析**: 集成AI对话助手，提供智能投资建议
- **市场情绪分析**: 基于FinBERT模型的专业金融情绪分析，自动抓取新浪财经等新闻源 🆕
- **可视化图表**: TradingView集成，专业级K线图表
- **响应式设计**: 现代化的用户界面，适配各种设备

## 🏗️ 系统架构

### 技术栈
- **前端**: React + TypeScript + Vite + Tailwind CSS
- **后端**: Python + FastAPI + 多数据源集成
- **数据源**: Yahoo Finance、新浪财经等权威数据源
- **AI集成**: Claude AI对话助手
- **图表**: TradingView轻量级图表库

### 架构图
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端 (React)   │    │   后端API       │    │   数据源        │
├─────────────────┤    ├─────────────────┤    ├─────────────────┤
│ • 股票搜索       │───▶│ • 市场数据API    │───▶│ • Yahoo Finance │
│ • K线图表       │    │ • 历史数据API    │    │ • 新浪财经      │
│ • AI对话助手    │    │ • AI分析接口     │    │ • 其他数据源    │
│ • 实时行情      │    │ • 缓存机制       │    └─────────────────┘
└─────────────────┘    └─────────────────┘
```

## 📈 当前功能进度

### ✅ 已完成功能

#### 1. 核心市场数据功能
- [x] **实时行情查询**: 支持A股、美股、港股实时数据获取
- [x] **多数据源集成**: Yahoo Finance + 新浪财经双数据源保障
- [x] **智能股票搜索**: 支持股票代码、中文公司名称搜索
- [x] **错误处理机制**: 完善的异常处理和降级策略
- [x] **数据验证优化**: 放宽价格范围验证，支持真实市场数据变化
- [x] **高频限流优化**: 提高开发环境请求限制（1000次/小时）

#### 2. 历史数据系统
- [x] **真实历史数据**: 30天历史K线数据，来源真实市场
- [x] **历史数据API**: `/api/market/historical/{symbol}?period=30d`
- [x] **数据格式标准化**: 统一的OHLCV数据格式
- [x] **数据质量保障**: 真实数据源，拒绝模拟数据
- [x] **交易日过滤**: 自动过滤非交易日（周末、节假日）

#### 3. AI对话分析系统
- [x] **AI聊天侧边栏**: 集成Claude AI智能助手
- [x] **历史数据表格**: 自动生成15天开盘收盘价表格
- [x] **智能分析**: 基于真实数据的AI投资建议
- [x] **数据溯源**: 明确标注数据来源，确保透明度

#### 4. 市场情绪分析系统 🆕
- [x] **FinBERT情绪分析**: 使用专业金融BERT模型分析市场情绪
- [x] **新闻自动抓取**: 从新浪财经等权威源自动获取最新新闻
- [x] **情绪评分**: 0-100分量化情绪，Bullish/Neutral/Bearish评级
- [x] **关键驱动因素**: 自动提取影响情绪的关键新闻
- [x] **多源支持**: 支持Reddit社交媒体分析（可选配置）
- [x] **实时更新**: 基于最新新闻实时分析市场情绪

####  5. 可视化图表
- [x] **TradingView集成**: 专业级K线图表组件（lightweight-charts v5）
- [x] **图表缩放**: 支持鼠标滚轮缩放和拖拽平移
- [x] **日期范围选择**: 7天、14天、30天数据快速切换
- [x] **交易日显示**: Business Day模式自动跳过周末
- [x] **错误处理**: 图表异常自动降级处理
- [x] **响应式设计**: 适配移动端和桌面端

#### 5. 系统架构优化
- [x] **限流机制**: 基于令牌桶的API限流保护（可配置）
- [x] **熔断机制**: 数据源异常时的自动降级
- [x] **缓存策略**: 智能缓存减少API调用
- [x] **日志监控**: 完整的请求日志和错误追踪
- [x] **JSON序列化优化**: 统一处理datetime等特殊类型

#### 6. 前端UI优化
- [x] **Tailwind CSS v4**: 现代化CSS框架升级
- [x] **Lucide图标**: 替换传统图标库为现代化图标
- [x] **响应式布局**: 优化的侧边栏和导航栏设计
- [x] **专业配色**: 金融级配色方案（Slate/Blue主题）

### 🔧 已知问题与待优化事项
- [ ] **技术指标分析**: MACD、KDJ、RSI等专业指标
- [ ] **基本面数据展示**: 财务报表、估值指标可视化
- [ ] **市场热力图**: 板块轮动和热点追踪
- [ ] **自选股功能**: 个人股票组合管理
- [ ] **数据缓存优化**: 减少重复API调用

## 🎯 核心API接口

### 市场数据API
```bash
# 获取实时行情
POST /api/market-data
Body: {"query": "000001"}

# 获取历史数据（30天真实数据）
GET /api/market/historical/000001?period=30d&count=30

# 获取热门股票
GET /api/market-data/hot
```

### 响应示例
```json
{
  "status": "success",
  "symbol": "000001",
  "data": [
    {
      "timestamp": "2025-11-14T00:00:00+08:00",
      "open": 11.67,
      "high": 11.84,
      "low": 11.66,
      "close": 11.75,
      "volume": 131699498,
      "data_source": "real"
    }
  ],
  "count": 15,
  "period": "15d"
}
```

## 🤖 AI分析功能

### 智能对话特性
- **历史数据展示**: 自动生成15天开盘收盘价表格
- **技术分析**: 基于真实数据的趋势分析
- **风险提示**: 明确标注数据来源和分析局限性
- **个性化建议**: 结合用户查询的股票特点

### 示例对话
```
用户: 帮我分析000001的历史数据
AI: 📊 **平安银行(000001) 智能分析报告**

📊 **真实市场数据**

📈 **近15日开盘收盘价数据**
```
日期        开盘价    收盘价    涨跌幅
----------  --------  --------  --------
2025-11-01  11.34     11.43     +0.79%
2025-11-04  11.42     11.59     +1.49%
...
```

📊 **统计信息**
• 15日平均开盘价: ¥11.45
• 15日平均收盘价: ¥11.52
• 15日最高价: ¥11.84
• 15日最低价: ¥11.30
```

## 🚀 快速开始

### 环境要求
- Node.js 18+ 
- Python 3.9+
- 8000端口可用

### 启动步骤
```bash
# 1. 克隆项目并安装依赖
git clone <repository-url>
cd AI-fundin

# 2. 安装Python依赖（推荐使用虚拟环境）
python3 -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt

# 3. 启动后端API服务
# 使用虚拟环境的Python
venv/bin/python backend/api_server.py --port 8000
# 或者直接在backend目录下运行
cd backend && python api_server.py

# 4. 启动前端开发服务器（新终端窗口）
cd frontendV2
npm install
npm run dev

# 5. 访问应用
# 前端地址：http://localhost:3005（端口会自动递增）
# 后端API：http://localhost:8000
```

### 常见问题

**Q: 后端启动时提示"Address already in use"**
A: 端口8000已被占用，可以使用以下命令停止占用进程：
```bash
lsof -t -i:8000 | xargs kill -9
```

**Q: 前端显示"数据加载中"或使用模拟数据**
A: 确保后端服务已启动且运行在8000端口。检查浏览器控制台是否有API错误。

**Q: 数据验证失败错误**
A: 这是正常现象，系统已优化验证规则以支持真实市场数据的变化。

## 📊 数据质量承诺

### 真实数据源
- **Yahoo Finance**: 全球权威金融数据提供商
- **新浪财经**: 国内领先财经数据平台
- **多重验证**: 交叉验证确保数据准确性

### 数据透明度
- **来源标注**: 每条数据都明确标注数据源
- **时间戳**: 完整的时间序列数据
- **完整性检查**: 自动检测数据缺失和异常

### 拒绝模拟数据
- ❌ 不使用随机生成的模拟数据
- ✅ 所有展示数据均来自真实市场
- ✅ 无数据时明确提示"暂无历史数据"

## 🎯 未来功能规划

### 近期目标 (1-2个月)
- [ ] **技术指标系统**: MACD、KDJ、布林带等
- [ ] **多周期分析**: 1分钟、5分钟、日线、周线
- [ ] **板块分析**: 行业板块热力图和轮动分析
- [ ] **资金流向**: 主力资金、北向资金流向追踪

### 中期目标 (3-6个月)
- [ ] **基本面分析**: 财务报表智能解读
- [ ] **估值模型**: DCF、PE、PB等多种估值方法
- [ ] **组合回测**: 历史策略回测和优化
- [ ] **预警系统**: 价格异动、技术指标信号提醒

### 长期愿景 (6-12个月)
- [ ] **量化策略**: 基于AI的量化交易策略
- [ ] **情绪分析**: 新闻、社交媒体情绪分析
- [ ] **预测模型**: 股价趋势预测（仅供学习参考）
- [ ] **社区功能**: 投资者交流和策略分享平台

## 🔧 技术架构详解

### 前端架构
```
frontendV2/
├── src/
│   ├── components/          # 可复用组件
│   │   ├── AIChat/         # AI对话组件
│   │   ├── KLineChart/     # K线图表组件
│   │   └── ...
│   ├── pages/              # 页面组件
│   │   ├── MarketQueryPage.tsx
│   │   └── ...
│   ├── services/           # API服务层
│   │   └── stockAPI.ts     # 股票数据API
│   └── utils/              # 工具函数
```

### 后端架构
```
backend/
├── api_server.py           # API服务器主入口
└── skills/
    └── market_data_tool/   # 市场数据工具
        ├── data_sources/   # 数据源集成
        ├── services/       # 业务逻辑层
        ├── utils/          # 工具模块
        └── skill.py        # 主逻辑入口
```

### 数据流
```
用户请求 → 前端组件 → API服务层 → 后端服务 → 数据源
    ↓           ↓           ↓           ↓         ↓
界面展示 ← 状态管理 ← 响应处理 ← 数据处理 ← 原始数据
```

## 🤝 贡献指南

欢迎提交Issue和Pull Request！

### 开发规范
- 遵循TypeScript和Python类型注解
- 编写单元测试和集成测试
- 保持代码注释清晰完整
- 遵循项目现有的代码风格

### 提交规范
- 使用清晰的提交信息
- 关联相关Issue
- 提供详细的变更说明

## 📄 开源协议

本项目采用MIT协议开源，详见 [LICENSE](LICENSE) 文件。

## 📞 联系方式

如有问题或建议，欢迎通过以下方式联系：
- 提交GitHub Issue
- 发送详细的功能建议

---

**⚠️ 免责声明**: 本项目仅供学习和研究使用，所有数据和分析结果不构成投资建议。投资有风险，入市需谨慎。